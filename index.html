<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Svenska Trainer Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 500px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { color: #005293; margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; transition: background 0.3s; }
        button { width: 100%; padding: 12px; background: #005293; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .quiz-box { background: #e7f3ff; padding: 15px; border-radius: 8px; text-align: center; }
        .word-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; font-size: 0.9em; }
        #qFeed { margin-top: 10px; font-weight: bold; }
        label { display: block; text-align: left; font-size: 0.8em; color: #666; margin-top: 5px; }
        .correct { background-color: #d4edda !important; border-color: #28a745 !important; }
        .wrong { background-color: #f8d7da !important; border-color: #dc3545 !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>‚ûï Neues Wort</h2>
        <input type="text" id="inDe" placeholder="Deutsch...">
        <button onclick="autoTr()">√úbersetzen & Speichern</button>
        <input type="text" id="inEn" placeholder="Englisch">
        <input type="text" id="inSv" placeholder="Schwedisch">
        <button style="background:#28a745" onclick="manualSave()">Manuell Speichern</button>
    </div>

    <div class="card">
        <h2>üß† √úben</h2>
        <div class="quiz-box">
            <p>√úbersetze dieses Wort:</p>
            <h1 id="qDe" style="margin:5px 0;">---</h1>
            
            <label>Englisch:</label>
            <input type="text" id="qAnsEn" placeholder="Englisch...">
            
            <label>Schwedisch:</label>
            <input type="text" id="qAnsSv" placeholder="Schwedisch..." onkeypress="if(event.key==='Enter') checkAns()">
            
            <button onclick="checkAns()" style="margin-top:10px;">Pr√ºfen</button>
            <div id="qFeed"></div>
            <button style="background:#666; margin-top:10px;" onclick="nextQ()">N√§chstes Wort ‚û°Ô∏è</button>
        </div>
    </div>

    <div class="card">
        <h2>üìñ Deine Liste (<span id="count">0</span>)</h2>
        <div id="listCont"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB4ViTtin8mGcayWbXX-UtpTpPF5E4u68Q",
        authDomain: "uebersetzer-d-eng-swe.firebaseapp.com",
        projectId: "uebersetzer-d-eng-swe",
        storageBucket: "uebersetzer-d-eng-swe.firebasestorage.app",
        messagingSenderId: "28644987259",
        appId: "1:28644987259:web:ad9844766de2ced699adde",
        measurementId: "G-WDX870XE6B"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let allWords = [];
    let curWord = null;

    async function autoTr() {
        const de = document.getElementById('inDe').value;
        if(!de) return;
        try {
            const rEn = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(de)}&langpair=de|en`);
            const dEn = await rEn.json();
            const rSv = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(de)}&langpair=de|sv`);
            const dSv = await rSv.json();
            document.getElementById('inEn').value = dEn.responseData.translatedText;
            document.getElementById('inSv').value = dSv.responseData.translatedText;
            manualSave();
        } catch(e) { alert("Fehler!"); }
    }

    function manualSave() {
        const de = document.getElementById('inDe').value;
        const en = document.getElementById('inEn').value;
        const sv = document.getElementById('inSv').value;
        if(!de || !sv) return;
        db.collection("words").add({ de, en, sv, ts: firebase.firestore.FieldValue.serverTimestamp() })
        .then(() => {
            document.getElementById('inDe').value = "";
            document.getElementById('inEn').value = "";
            document.getElementById('inSv').value = "";
            init();
        });
    }

    function init() {
        db.collection("words").orderBy("ts", "desc").get().then(s => {
            allWords = s.docs.map(d => ({id: d.id, ...d.data()}));
            document.getElementById('count').innerText = allWords.length;
            renderList();
            if(!curWord && allWords.length > 0) nextQ();
        });
    }

    function renderList() {
        let h = "";
        allWords.forEach(w => {
            h += `<div class="word-item"><span><b>${w.de}</b>: ${w.sv} (${w.en})</span><button style="width:auto;background:red;padding:2px 7px;" onclick="del('${w.id}')">X</button></div>`;
        });
        document.getElementById('listCont').innerHTML = h;
    }

    function del(id) { if(confirm("L√∂schen?")) db.collection("words").doc(id).delete().then(init); }

    function nextQ() {
        if(allWords.length === 0) return;
        curWord = allWords[Math.floor(Math.random() * allWords.length)];
        
        document.getElementById('qDe').innerText = curWord.de;
        
        // Reset Inputs und Farben
        const inEn = document.getElementById('qAnsEn');
        const inSv = document.getElementById('qAnsSv');
        
        inEn.value = curWord.en ? curWord.en.charAt(0) : "";
        inSv.value = curWord.sv ? curWord.sv.charAt(0) : "";
        
        inEn.className = "";
        inSv.className = "";
        
        document.getElementById('qFeed').innerText = "";
        inEn.focus();
    }

    function checkAns() {
        const inEn = document.getElementById('qAnsEn');
        const inSv = document.getElementById('qAnsSv');
        
        const valEn = inEn.value.toLowerCase().trim();
        const valSv = inSv.value.toLowerCase().trim();
        
        const corEn = curWord.en.toLowerCase().trim();
        const corSv = curWord.sv.toLowerCase().trim();
        
        // Englisch pr√ºfen
        if(valEn === corEn) {
            inEn.className = "correct";
        } else {
            inEn.className = "wrong";
        }
        
        // Schwedisch pr√ºfen
        if(valSv === corSv) {
            inSv.className = "correct";
        } else {
            inSv.className = "wrong";
        }

        const feed = document.getElementById('qFeed');
        if(valEn === corEn && valSv === corSv) {
            feed.innerHTML = "<span style='color:green'>Beides richtig! ‚ú®</span>";
        } else {
            feed.innerHTML = "<span style='color:red'>√úberpr√ºfe die roten Felder.</span>";
        }
    }

    init();
</script>
</body>
</html>
