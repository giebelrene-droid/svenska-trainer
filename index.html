<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Trainer 4.0.3 (Anker-Logik)</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%232d3748%22/><text x=%2250%22 y=%2270%22 font-size=%2250%22 text-anchor=%22middle%22 fill=%22white%22>üëë</text></svg>">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --primary: #005293; --accent: #FECC00; --bg: #f4f7f9; --text: #1a2b3c; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 15px; color: var(--text); max-width: 500px; margin: 0 auto; }
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .badge { background: white; padding: 5px 12px; border-radius: 15px; font-weight: bold; font-size: 0.85em; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .settings-btn { background: white; border: none; font-size: 1.2em; cursor: pointer; padding: 5px 10px; border-radius: 50%; }
        .nav { display: flex; gap: 5px; margin-bottom: 20px; overflow-x: auto; }
        .nav button { background: #d1dce5; flex: 1; padding: 10px; font-size: 11px; color: #4a627a; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; white-space: nowrap; }
        .nav button.active { background: var(--primary); color: white; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 82, 147, 0.3); }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 20px; position: relative; }
        h2 { color: var(--primary); margin-top: 0; font-size: 1.2em; font-weight: 800; }
        label { display: block; font-size: 0.7em; font-weight: 700; color: #7f8c8d; margin: 10px 0 3px 3px; text-transform: uppercase; }
        .input-row { display: flex; align-items: center; gap: 5px; width: 100%; margin-bottom: 5px; }
        input, select { flex: 1; padding: 12px; background: #f8fafc; border: 2px solid #edf2f7; border-radius: 12px; font-size: 16px; width: 100%; box-sizing: border-box; }
        .action-btn { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; }
        .mic-btn, .speaker-btn { background: white; border: 1px solid #e2e8f0; font-size: 14px; cursor: pointer; border-radius: 8px; padding: 8px; min-width: 35px; }
        .verb-section { background: #edf2f7; padding: 12px; border-radius: 12px; margin-top: 15px; display: none; }
        .verb-lang-group { margin-bottom: 12px; border-bottom: 1px solid #dce4ea; padding-bottom: 8px; }
        .verb-row { display: flex; gap: 8px; }
        .verb-row input { font-size: 0.85em; padding: 8px; }
    </style>
</head>
<body>

<div class="header-row">
    <div class="badge">üî• <span id="streakDisplay">0</span></div>
    <div class="badge">üìö <span id="wordCount">0</span> W√∂rter</div>
    <div class="badge" style="color: var(--primary);"><span id="versionDisplay"></span></div>
    <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>
</div>

<div class="nav">
    <button id="btn1" class="active" onclick="showTab('add')">‚ûï NEU</button>
    <button id="btn2" onclick="showTab('quiz')">üß† √úBEN</button>
    <button id="btn4" onclick="showTab('challenge')">‚è±Ô∏è CHALLENGE</button>
    <button id="btn3" onclick="showTab('list')">üìñ LISTE</button>
</div>

<div id="debugBox" style="background:#1a202c; color:#48bb78; padding:12px; border-radius:12px; font-family:monospace; font-size:11px; margin-bottom:15px; display:none; border: 1px solid #2d3748; white-space: pre-wrap;"></div>

<div id="tabAdd" class="card">
    <h2 id="addTitle">Neues Wort</h2>
    <div id="loader" style="color:var(--primary); text-align:center; display:none; font-weight:bold;">ü§ñ KI arbeitet...</div>
    <input type="hidden" id="editId">
    
    <label>L1</label>
    <div class="input-row"><input type="text" id="inDe"></div>
    <label>L2</label>
    <div class="input-row"><input type="text" id="inEn"></div>
    <label>L3</label>
    <div class="input-row"><input type="text" id="inSv"></div>
    
    <button class="action-btn" style="background:#4a5568; font-size:0.8em; padding:10px;" onclick="toggleVerbSection()">üìù Verb-Details</button>
    
    <div id="verbSection" class="verb-section">
        <div class="verb-lang-group"><label>L1</label><div class="verb-row"><input type="text" id="inDePast" placeholder="Er..."><input type="text" id="inDeFut" placeholder="Er wird..."></div></div>
        <div class="verb-lang-group"><label>L2</label><div class="verb-row"><input type="text" id="inEnPast" placeholder="He..."><input type="text" id="inEnFut" placeholder="He will..."></div></div>
        <div class="verb-lang-group"><label>L3</label><div class="verb-row"><input type="text" id="inSvPast" placeholder="Han..."><input type="text" id="inSvFut" placeholder="Han kommer att..."></div></div>
        <button class="action-btn" style="background:#e67e22; font-size:0.9em; margin-top:5px;" onclick="fetchVerbForms()">‚ö° Formen suchen</button>
    </div>

    <button class="action-btn" onclick="handleSmartTranslate()" style="background:#e67e22; margin-top:15px;">1. √úbersetzen</button>
    <button class="action-btn" style="background:#48bb78" onclick="manualSave()">2. Speichern</button>
</div>

<script>
    const VERSION = "18.02.2026 - 15:20";
    // Firebase Initialisierung hier einf√ºgen...

    async function translate(txt, src, tgt) {
        const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(txt)}&langpair=${src}|${tgt}`;
        const res = await fetch(url);
        const data = await res.json();
        return data.responseData.translatedText;
    }

    async function fetchVerbForms() {
        const baseDe = document.getElementById('inDe').value.trim();
        const baseEn = document.getElementById('inEn').value.trim();
        const debug = document.getElementById('debugBox');
        
        if(!baseDe || !baseEn) return alert("Bitte erst Deutsch und Englisch ausf√ºllen.");
        
        debug.style.display = "block";
        debug.innerHTML = "‚è≥ KI wird abgefragt...";
        document.getElementById('loader').style.display = "block";
        
        try {
            const rawEnPast = await translate(`Yesterday he ${baseEn}`, 'en', 'en');
            const rawDePast = await translate(`Gestern ist er ${baseDe}`, 'de', 'de');
            const rawSvPast = await translate(`Yesterday he ${baseEn}`, 'en', 'sv');
            
            // DIAGNOSE ANZEIGE - Hier greifen wir die Daten ab!
            debug.innerHTML = "<b>ROH-DATEN VON DER KI:</b>\n" + 
                              "EN (Past): " + rawEnPast + "\n" +
                              "DE (Past): " + rawDePast + "\n" +
                              "SV (Past): " + rawSvPast;

            const anchorClean = (rawText, pronoun) => {
                if (!rawText) return pronoun + " ...";
                const lowerText = rawText.toLowerCase();
                const lowerPronoun = pronoun.toLowerCase();
                const index = lowerText.indexOf(lowerPronoun);
                if (index !== -1) {
                    return rawText.substring(index).trim().replace(/[.!]$/, "");
                }
                return pronoun + " " + rawText.trim().replace(/[.!]$/, "");
            };

            document.getElementById('inEnPast').value = anchorClean(rawEnPast, "He");
            document.getElementById('inDePast').value = anchorClean(rawDePast, "Er");
            document.getElementById('inSvPast').value = anchorClean(rawSvPast, "Han");

            document.getElementById('inDeFut').value = "Er wird " + baseDe;
            document.getElementById('inEnFut').value = "He will " + baseEn;
            const rawSvFut = await translate(`He will ${baseEn}`, 'en', 'sv');
            document.getElementById('inSvFut').value = anchorClean(rawSvFut, "Han");

        } catch(e) { 
            debug.innerHTML = "‚ùå Fehler: " + e.message;
        } finally { 
            document.getElementById('loader').style.display = "none"; 
        }
    }

    function toggleVerbSection() {
        const el = document.getElementById('verbSection');
        el.style.display = (el.style.display === "block") ? "none" : "block";
    }

    function showTab(n) {
        document.getElementById('tabAdd').style.display = (n === 'add') ? 'block' : 'none';
    }

    window.onload = () => { document.getElementById('versionDisplay').innerText = VERSION; };
</script>
</body>
</html>
