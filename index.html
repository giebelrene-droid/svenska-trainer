<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Svenska Trainer Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; color: #333; margin: 0; }
        .container { max-width: 500px; margin: auto; }
        .nav { display: flex; gap: 8px; margin-bottom: 20px; }
        .nav button { background: #888; flex: 1; padding: 15px 5px; font-size: 14px; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .nav button.active { background: #005293; border: 2px solid #ffcc00; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { color: #005293; margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; transition: all 0.3s; }
        button.action-btn { width: 100%; padding: 12px; background: #005293; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .quiz-box { background: #e7f3ff; padding: 15px; border-radius: 8px; text-align: center; }
        label { display: block; text-align: left; font-size: 0.8em; color: #666; margin-top: 5px; }
        #qFeed { margin-top: 10px; font-weight: bold; min-height: 24px; }
        .correct { background-color: #d4edda !important; border-color: #28a745 !important; color: #155724; }
        .wrong { background-color: #f8d7da !important; border-color: #dc3545 !important; color: #721c24; }
        .word-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; align-items: center; }
        .word-info { flex: 1; padding-right: 10px; line-height: 1.4; }
        .word-actions { display: flex; gap: 5px; }
        .edit-btn { background: #ffcc00; color: #333; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 14px; }
        .del-btn { background: #ff4d4d; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 14px; }
        #loader { color: #005293; font-weight: bold; text-align: center; display: none; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="wordCount" style="text-align:right; font-size:0.9em; margin-bottom:10px; color:#005293; font-weight:bold;">Bestand wird geladen...</div>

    <div class="nav">
        <button id="btn1" class="active" onclick="showTab('add')">‚ûï NEU</button>
        <button id="btn2" onclick="showTab('quiz')">üß† √úBEN</button>
        <button id="btn3" onclick="showTab('list')">üìñ LISTE</button>
    </div>

    <div id="tabAdd" class="card">
        <h2 id="addTitle">Neuzugang</h2>
        <div id="loader">Wird √ºbersetzt... ‚è≥</div>
        <input type="hidden" id="editId">
        <label>Deutsch:</label>
        <input type="text" id="inDe" placeholder="Deutsch...">
        <label>Englisch:</label>
        <input type="text" id="inEn" placeholder="Englisch...">
        <label>Schwedisch:</label>
        <input type="text" id="inSv" placeholder="Schwedisch...">
        
        <button class="action-btn" style="margin-top:10px;" onclick="handleSmartTranslate()">√úbersetzen & Speichern</button>
        <button class="action-btn" style="background:#28a745" onclick="manualSave()">Nur Speichern</button>
        <button id="cancelEdit" class="action-btn" style="background:#666; display:none;" onclick="resetForm()">Abbrechen</button>
    </div>

    <div id="tabQuiz" class="card" style="display:none">
        <h2>Trainer</h2>
        <div class="quiz-box">
            <p>√úbersetze dieses Wort:</p>
            <h1 id="qDe" style="margin:5px 0;">---</h1>
            <label>Englisch:</label>
            <input type="text" id="qAnsEn">
            <label>Schwedisch:</label>
            <input type="text" id="qAnsSv" onkeypress="if(event.key==='Enter') checkAns()">
            <button class="action-btn" onclick="checkAns()" style="margin-top:10px;">Pr√ºfen</button>
            <div id="qFeed"></div>
            <button class="action-btn" style="background:#666; margin-top:10px;" onclick="nextQ()">N√§chstes Wort ‚û°Ô∏è</button>
        </div>
    </div>

    <div id="tabList" class="card" style="display:none">
        <h2>Vokabelheft</h2>
        <div id="listCont"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB4ViTtin8mGcayWbXX-UtpTpPF5E4u68Q",
        authDomain: "uebersetzer-d-eng-swe.firebaseapp.com",
        projectId: "uebersetzer-d-eng-swe",
        storageBucket: "uebersetzer-d-eng-swe.firebasestorage.app",
        messagingSenderId: "28644987259",
        appId: "1:28644987259:web:ad9844766de2ced699adde",
        measurementId: "G-WDX870XE6B"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let allWords = [];
    let curWord = null;
    let lastWordId = null;

    function showTab(name) {
        document.getElementById('tabAdd').style.display = (name === 'add') ? 'block' : 'none';
        document.getElementById('tabQuiz').style.display = (name === 'quiz') ? 'block' : 'none';
        document.getElementById('tabList').style.display = (name === 'list') ? 'block' : 'none';
        document.getElementById('btn1').className = (name === 'add') ? 'active' : '';
        document.getElementById('btn2').className = (name === 'quiz') ? 'active' : '';
        document.getElementById('btn3').className = (name === 'list') ? 'active' : '';
        refreshData().then(() => {
            if(name === 'list') renderList();
            if(name === 'quiz') nextQ();
        });
    }

    async function handleSmartTranslate() {
        const de = document.getElementById('inDe').value.trim();
        const en = document.getElementById('inEn').value.trim();
        const sv = document.getElementById('inSv').value.trim();
        let sourceText = de || en || sv;
        let sourceLang = de ? "de" : (en ? "en" : "sv");
        if (!sourceText) return;
        document.getElementById('loader').style.display = "block";
        try {
            const targets = ["de", "en", "sv"];
            for (let t of targets) {
                if (t !== sourceLang) {
                    const r = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(sourceText)}&langpair=${sourceLang}|${t}`);
                    const d = await r.json();
                    document.getElementById('in'+t.charAt(0).toUpperCase()+t.slice(1)).value = d.responseData.translatedText;
                }
            }
            manualSave();
        } catch(e) { alert("Fehler!"); }
        finally { document.getElementById('loader').style.display = "none"; }
    }

    function manualSave() {
        const de = document.getElementById('inDe').value.trim();
        const en = document.getElementById('inEn').value.trim();
        const sv = document.getElementById('inSv').value.trim();
        const editId = document.getElementById('editId').value;
        if(!de || !sv) return;
        const data = { de, en, sv, ts: firebase.firestore.FieldValue.serverTimestamp() };
        if(editId) {
            db.collection("words").doc(editId).update(data).then(() => {
                resetForm();
                showTab('list');
            });
        } else {
            db.collection("words").add(data).then(() => resetForm());
        }
    }

    function editWord(id) {
        const w = allWords.find(word => word.id === id);
        if(!w) return;
        document.getElementById('editId').value = w.id;
        document.getElementById('inDe').value = w.de;
        document.getElementById('inEn').value = w.en;
        document.getElementById('inSv').value = w.sv;
        document.getElementById('addTitle').innerText = "Wort bearbeiten";
        document.getElementById('cancelEdit').style.display = "block";
        showTab('add');
    }

    function resetForm() {
        document.getElementById('editId').value = "";
        document.getElementById('inDe').value = "";
        document.getElementById('inEn').value = "";
        document.getElementById('inSv').value = "";
        document.getElementById('addTitle').innerText = "Neuzugang";
        document.getElementById('cancelEdit').style.display = "none";
        refreshData();
    }

    async function refreshData() {
        const s = await db.collection("words").orderBy("ts", "desc").get();
        allWords = s.docs.map(d => ({id: d.id, ...d.data()}));
        document.getElementById('wordCount').innerText = "Bestand: " + allWords.length + " W√∂rter";
    }

    function renderList() {
        let h = "";
        allWords.forEach(w => {
            h += `<div class="word-item">
                <div class="word-info">
                    <b>${w.de}</b>: ${w.sv}<br>
                    <small style="color:#666">Englisch: ${w.en || '-'}</small>
                </div>
                <div class="word-actions">
                    <button class="edit-btn" onclick="editWord('${w.id}')">‚úé</button>
                    <button class="del-btn" onclick="del('${w.id}')">X</button>
                </div>
            </div>`;
        });
        document.getElementById('listCont').innerHTML = h || "Liste leer.";
    }

    function del(id) { if(confirm("L√∂schen?")) db.collection("words").doc(id).delete().then(() => { refreshData().then(renderList); }); }

    function nextQ() {
        if(allWords.length === 0) return;
        let n;
        if(allWords.length > 1) { do { n = allWords[Math.floor(Math.random()*allWords.length)]; } while(n.id===lastWordId); }
        else { n = allWords[0]; }
        curWord = n; lastWordId = n.id;
        document.getElementById('qDe').innerText = curWord.de;
        const e = document.getElementById('qAnsEn'), s = document.getElementById('qAnsSv');
        e.value = curWord.en ? curWord.en.charAt(0) : "";
        s.value = curWord.sv ? curWord.sv.charAt(0) : "";
        e.className = ""; s.className = "";
        document.getElementById('qFeed').innerText = "";
    }

    function checkAns() {
        const e = document.getElementById('qAnsEn'), s = document.getElementById('qAnsSv');
        const cE = curWord.en.toLowerCase().trim(), cS = curWord.sv.toLowerCase().trim();
        const rE = e.value.toLowerCase().trim() === cE, rS = s.value.toLowerCase().trim() === cS;
        e.className = rE ? "correct" : "wrong"; s.className = rS ? "correct" : "wrong";
        document.getElementById('qFeed').innerHTML = (rE && rS) ? "<span style='color:green'>Richtig! ‚ú®</span>" : `<span style='color:red'>Korrektur:</span><br><small>En: ${curWord.en} | Sv: ${curWord.sv}</small>`;
    }
    refreshData();
</script>
</body>
</html>
