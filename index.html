<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Svenska Trainer Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; color: #333; margin: 0; }
        .container { max-width: 500px; margin: auto; }
        .nav { display: flex; gap: 8px; margin-bottom: 20px; }
        .nav button { background: #888; flex: 1; padding: 15px 5px; font-size: 14px; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .nav button.active { background: #005293; border: 2px solid #ffcc00; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { color: #005293; margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; transition: all 0.3s; }
        button.action-btn { width: 100%; padding: 12px; background: #005293; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .quiz-box { background: #e7f3ff; padding: 15px; border-radius: 8px; text-align: center; }
        label { display: block; text-align: left; font-size: 0.8em; color: #666; margin-top: 5px; }
        #qFeed { margin-top: 10px; font-weight: bold; min-height: 24px; }
        .correct { background-color: #d4edda !important; border-color: #28a745 !important; color: #155724; }
        .wrong { background-color: #f8d7da !important; border-color: #dc3545 !important; color: #721c24; }
        .solution-text { display: block; font-size: 0.9em; color: #d9534f; margin-top: 5px; font-weight: normal; }
        .word-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; align-items: center; }
        #loader { color: #005293; font-weight: bold; text-align: center; display: none; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="wordCount" style="text-align:right; font-size:0.9em; margin-bottom:10px; color:#005293; font-weight:bold;">Bestand wird geladen...</div>

    <div class="nav">
        <button id="btn1" class="active" onclick="showTab('add')">‚ûï NEU</button>
        <button id="btn2" onclick="showTab('quiz')">üß† √úBEN</button>
        <button id="btn3" onclick="showTab('list')">üìñ LISTE</button>
    </div>

    <div id="tabAdd" class="card">
        <h2>Neuzugang</h2>
        <div id="loader">Wird √ºbersetzt... ‚è≥</div>
        <label>Deutsch:</label>
        <input type="text" id="inDe" placeholder="Deutsch...">
        <label>Englisch:</label>
        <input type="text" id="inEn" placeholder="Englisch...">
        <label>Schwedisch:</label>
        <input type="text" id="inSv" placeholder="Schwedisch...">
        
        <button class="action-btn" style="margin-top:10px;" onclick="handleSmartTranslate()">√úbersetzen & Speichern</button>
        <button class="action-btn" style="background:#28a745" onclick="manualSave()">Nur Speichern (ohne Suche)</button>
    </div>

    <div id="tabQuiz" class="card" style="display:none">
        <h2>Trainer</h2>
        <div class="quiz-box">
            <p>√úbersetze dieses Wort:</p>
            <h1 id="qDe" style="margin:5px 0;">---</h1>
            <label>Englisch:</label>
            <input type="text" id="qAnsEn" placeholder="Englisch...">
            <label>Schwedisch:</label>
            <input type="text" id="qAnsSv" placeholder="Schwedisch..." onkeypress="if(event.key==='Enter') checkAns()">
            <button class="action-btn" onclick="checkAns()" style="margin-top:10px;">Pr√ºfen</button>
            <div id="qFeed"></div>
            <button id="nextBtn" class="action-btn" style="background:#666; margin-top:10px;" onclick="nextQ()">N√§chstes Wort ‚û°Ô∏è</button>
        </div>
    </div>

    <div id="tabList" class="card" style="display:none">
        <h2>Vokabelheft</h2>
        <div id="listCont"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB4ViTtin8mGcayWbXX-UtpTpPF5E4u68Q",
        authDomain: "uebersetzer-d-eng-swe.firebaseapp.com",
        projectId: "uebersetzer-d-eng-swe",
        storageBucket: "uebersetzer-d-eng-swe.firebasestorage.app",
        messagingSenderId: "28644987259",
        appId: "1:28644987259:web:ad9844766de2ced699adde",
        measurementId: "G-WDX870XE6B"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let allWords = [];
    let curWord = null;
    let lastWordId = null;

    function showTab(name) {
        document.getElementById('tabAdd').style.display = (name === 'add') ? 'block' : 'none';
        document.getElementById('tabQuiz').style.display = (name === 'quiz') ? 'block' : 'none';
        document.getElementById('tabList').style.display = (name === 'list') ? 'block' : 'none';
        document.getElementById('btn1').className = (name === 'add') ? 'active' : '';
        document.getElementById('btn2').className = (name === 'quiz') ? 'active' : '';
        document.getElementById('btn3').className = (name === 'list') ? 'active' : '';
        refreshData().then(() => {
            if(name === 'list') renderList();
            if(name === 'quiz') nextQ();
        });
    }

    // Die neue smarte √úbersetzungs-Logik
    async function handleSmartTranslate() {
        const de = document.getElementById('inDe').value.trim();
        const en = document.getElementById('inEn').value.trim();
        const sv = document.getElementById('inSv').value.trim();
        
        let sourceText = "";
        let sourceLang = "";

        if (de) { sourceText = de; sourceLang = "de"; }
        else if (en) { sourceText = en; sourceLang = "en"; }
        else if (sv) { sourceText = sv; sourceLang = "sv"; }
        else { alert("Bitte mindestens ein Feld ausf√ºllen!"); return; }

        document.getElementById('loader').style.display = "block";

        try {
            // √úbersetzung in alle Zielsprachen
            const targets = ["de", "en", "sv"];
            for (let target of targets) {
                if (target !== sourceLang) {
                    const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(sourceText)}&langpair=${sourceLang}|${target}`);
                    const data = await res.json();
                    const translated = data.responseData.translatedText;
                    
                    if (target === "de") document.getElementById('inDe').value = translated;
                    if (target === "en") document.getElementById('inEn').value = translated;
                    if (target === "sv") document.getElementById('inSv').value = translated;
                }
            }
            manualSave();
        } catch(e) {
            alert("Fehler bei der √úbersetzung. Pr√ºfe deine Internetverbindung.");
        } finally {
            document.getElementById('loader').style.display = "none";
        }
    }

    function manualSave() {
        const de = document.getElementById('inDe').value.trim();
        const en = document.getElementById('inEn').value.trim();
        const sv = document.getElementById('inSv').value.trim();
        if(!de || !sv) { alert("Deutsch und Schwedisch werden mindestens ben√∂tigt!"); return; }
        
        db.collection("words").add({ de, en, sv, ts: firebase.firestore.FieldValue.serverTimestamp() })
        .then(() => {
            document.getElementById('inDe').value = "";
            document.getElementById('inEn').value = "";
            document.getElementById('inSv').value = "";
            refreshData();
        });
    }

    async function refreshData() {
        const s = await db.collection("words").orderBy("ts", "desc").get();
        allWords = s.docs.map(d => ({id: d.id, ...d.data()}));
        document.getElementById('wordCount').innerText = "Bestand: " + allWords.length + " W√∂rter";
    }

    function renderList() {
        let h = "";
        allWords.forEach(w => {
            h += `<div class="word-item"><span><b>${w.de}</b>: ${w.sv} (${w.en})</span><button style="width:auto;background:#ff4d4d;color:white;border:none;padding:3px 8px;border-radius:4px;" onclick="del('${w.id}')">X</button></div>`;
        });
        document.getElementById('listCont').innerHTML = h || "Liste leer.";
    }

    function del(id) {
        if(confirm("L√∂schen?")) db.collection("words").doc(id).delete().then(() => {
            refreshData().then(renderList);
        });
    }

    function nextQ() {
        if(allWords.length === 0) return;
        let nextWord;
        if (allWords.length > 1) {
            do { nextWord = allWords[Math.floor(Math.random() * allWords.length)]; } while (nextWord.id === lastWordId);
        } else { nextWord = allWords[0]; }
        curWord = nextWord;
        lastWordId = nextWord.id;
        document.getElementById('qDe').innerText = curWord.de;
        const inEn = document.getElementById('qAnsEn');
        const inSv = document.getElementById('qAnsSv');
        inEn.value = curWord.en ? curWord.en.charAt(0) : "";
        inSv.value = curWord.sv ? curWord.sv.charAt(0) : "";
        inEn.className = ""; inSv.className = "";
        document.getElementById('qFeed').innerText = "";
        inEn.focus();
    }

    function checkAns() {
        const inEn = document.getElementById('qAnsEn');
        const inSv = document.getElementById('qAnsSv');
        const corEn = curWord.en.toLowerCase().trim();
        const corSv = curWord.sv.toLowerCase().trim();
        const isEnCorrect = inEn.value.toLowerCase().trim() === corEn;
        const isSvCorrect = inSv.value.toLowerCase().trim() === corSv;
        inEn.className = isEnCorrect ? "correct" : "wrong";
        inSv.className = isSvCorrect ? "correct" : "wrong";
        const feed = document.getElementById('qFeed');
        if(isEnCorrect && isSvCorrect) {
            feed.innerHTML = "<span style='color:green'>Richtig! ‚ú®</span>";
        } else {
            let errorText = "<span style='color:red'>Fehler gefunden!</span><br>";
            if(!isEnCorrect) errorText += `<span class="solution-text">Englisch: <b>${curWord.en}</b></span>`;
            if(!isSvCorrect) errorText += `<span class="solution-text">Schwedisch: <b>${curWord.sv}</b></span>`;
            feed.innerHTML = errorText;
        }
    }
    refreshData();
</script>
</body>
</html>
